<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>문서 작성기</title>
  <style>
    body {
      font-family: 'Malgun Gothic', sans-serif;
      background-color: #f4f4f4;
      margin: 0;
      padding: 20px;
      display: flex;
      justify-content: center;
    }
    .main-container { display: flex; gap: 30px; width: 100%; max-width: 1200px; }
    .editor-container {
      display: flex; width: 700px; height: 85vh; min-width: 200px;
      min-height: 200px; resize: both; overflow: auto;
      border: 1px solid #ccc; background-color: white; border-radius: 4px;
    }
    #text-editor {
      width: 100%; height: 100%; padding: 15px;
      font-size: 15px; line-height: 1.6; box-sizing: border-box; outline: none;
    }
    #text-editor > * { text-indent: 1em; margin: 0; padding: 0; }
    .right-panel {
      width: 250px; flex-shrink: 0; display: flex; flex-direction: column; gap: 20px;
    }
    .controls-container, .recent-files-panel {
      padding: 20px; border: 1px solid #ddd;
      background-color: #ffffff; border-radius: 5px;
    }
    .control-group { margin-bottom: 25px; }
    .control-group label { display: block; margin-bottom: 5px; font-weight: bold; font-size: 0.9em; }
    .control-group .inline-controls { display: flex; gap: 10px; }
    .control-group select, .control-group input[type="number"] {
      width: 100%; padding: 8px; border: 1px solid #ccc;
      border-radius: 3px; box-sizing: border-box;
    }
    .control-group button {
      width: 100%; padding: 10px; border: 1px solid #ccc;
      background-color: #f0f0f0; cursor: pointer; font-weight: bold;
      border-radius: 3px; margin-bottom: 10px; transition: background-color 0.2s;
    }
    .control-group button:hover { background-color: #e0e0e0; }
    #file-input { display: none; }
    .char-count-container {
      padding: 15px; border: 1px solid red;
      border-radius: 3px; font-size: 0.9em;
    }
    .char-count-container p { margin: 5px 0; }
    .recent-files-panel label { font-weight: bold; margin-bottom: 10px; display: block; }
    #recent-files-list {
      list-style: none; padding: 0; margin: 0; max-height: 200px; overflow-y: auto;
    }
    #recent-files-list li {
      display: flex; justify-content: space-between; align-items: center;
      cursor: pointer; padding: 6px 4px; border-bottom: 1px solid #eee;
      transition: background-color 0.2s;
    }
    #recent-files-list li:hover { background-color: #f5f5f5; }
    #recent-files-list li button {
      margin-left: 10px; border: none; background: transparent;
      color: #999; font-size: 0.9em; cursor: pointer;
    }
    #recent-files-list li button:hover { color: crimson; }
  </style>
</head>
<body>
<div class="main-container">
  <div class="editor-container" id="editor-wrapper">
    <div id="text-editor" contenteditable="true" spellcheck="false"></div>
  </div>
  <div class="right-panel">
    <div class="controls-container">
      <div class="control-group">
        <label>폰트 설정</label>
        <div class="inline-controls">
          <select id="font-select">
            <option value="Sans">Sans</option>
            <option value="Serif">Serif</option>
            <option value="Monospace">Monospace</option>
            <option value="Malgun Gothic">맑은 고딕</option>
            <option value="Gulim">굴림</option>
            <option value="Dotum">돋움</option>
          </select>
          <input type="number" id="font-size-input" value="15" min="1">
        </div>
      </div>
      <div class="control-group">
        <input type="file" id="file-input" accept=".txt">
        <button id="load-btn">파일 열기</button>
        <button id="save-as-btn">텍스트 다운로드</button>
      </div>
      <div class="char-count-container">
        <p id="char-count-inc-space">공백포함: 0자</p>
        <p id="char-count-exc-space">공백미포함: 0자</p>
      </div>
    </div>
  </div>
</div>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const textEditor = document.getElementById('text-editor');
    const editorWrapper = document.getElementById('editor-wrapper');
    const fontSelect = document.getElementById('font-select');
    const fontSizeInput = document.getElementById('font-size-input');
    const loadBtn = document.getElementById('load-btn');
    const saveAsBtn = document.getElementById('save-as-btn');
    const fileInput = document.getElementById('file-input');
    const charCountIncSpace = document.getElementById('char-count-inc-space');
    const charCountExcSpace = document.getElementById('char-count-exc-space');

    function updateCharCount() {
      const text = textEditor.innerText;
      const countWithSpaces = text.replace(/\n/g, '').length;
      const countWithoutSpaces = text.replace(/\s/g, '').length;
      charCountIncSpace.textContent = `공백포함: ${countWithSpaces}자`;
      charCountExcSpace.textContent = `공백미포함: ${countWithoutSpaces}자`;
    }

    function getEditorText() {
      const lines = Array.from(textEditor.children).map(child => child.innerText.replace(/\r?\n/g, ''));
      return lines.join('\n');
    }

    function loadTextToEditor(text) {
      const lines = text.split('\n');
      const html = lines.map(line => line.trim() === '' ? '<div><br></div>' : `<div>${line}</div>`).join('');
      textEditor.innerHTML = html;
      updateCharCount();
    }

    fontSelect.addEventListener('change', e => {
      textEditor.style.fontFamily = e.target.value;
      localStorage.setItem('editorFontFamily', e.target.value);
    });

    fontSizeInput.addEventListener('input', e => {
      textEditor.style.fontSize = `${e.target.value}px`;
      localStorage.setItem('editorFontSize', e.target.value);
    });

    const resizeObserver = new ResizeObserver(() => {
      const styles = window.getComputedStyle(editorWrapper);
      localStorage.setItem('editorWidth', styles.width);
      localStorage.setItem('editorHeight', styles.height);
    });
    resizeObserver.observe(editorWrapper);

    textEditor.addEventListener('input', updateCharCount);

    loadBtn.addEventListener('click', () => {
      fileInput.click();
    });

    fileInput.addEventListener('change', async (event) => {
      const file = event.target.files[0];
      if (file) {
        const text = await file.text();
        loadTextToEditor(text);
      }
    });

    saveAsBtn.addEventListener('click', () => {
      const blob = new Blob([getEditorText()], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = '문서.txt';
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    });

    // 초기화
    const savedFont = localStorage.getItem('editorFontFamily');
    if (savedFont) {
      textEditor.style.fontFamily = savedFont;
      fontSelect.value = savedFont;
    }
    const savedFontSize = localStorage.getItem('editorFontSize');
    if (savedFontSize) {
      textEditor.style.fontSize = `${savedFontSize}px`;
      fontSizeInput.value = savedFontSize;
    }
    const savedWidth = localStorage.getItem('editorWidth');
    const savedHeight = localStorage.getItem('editorHeight');
    if (savedWidth) editorWrapper.style.width = savedWidth;
    if (savedHeight) editorWrapper.style.height = savedHeight;

    textEditor.innerHTML = '<div><br></div>';
    updateCharCount();
  });
</script>
</body>
</html>
